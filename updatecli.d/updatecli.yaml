#updatecli.yaml

name: Bump Helm Chart versions
scms:
  updatecli:
    kind: "github"
    spec:
      user: '{{ .scm.user }}'
      email: '{{ .scm.email }}'
      owner: '{{ .scm.owner }}'
      repository: '{{ .scm.repository }}'
      token: '{{ requiredEnv "GH_TOKEN" }}'
      username: '{{ .scm.username }}'
      branch: '{{ .scm.branch }}'

# Define the source of the data
sources:
  latestVersion:
    kind: helmchart
    spec: 
      url: https://azure.github.io/azure-workload-identity/charts
      name: workload-identity-webhook
  
  DevChartVersion:
    kind: yaml
    spec:
      file: "charts/argocd/utils/azure-workload-identity.yaml"
      key: "spec.generators[0].list.elements[1].targetRevision"


actions:
  helm-charts:
    kind: github/pullrequest
    scmid: "updatecli"
    spec:
      automerge: false
      description: "Prepend description"
      draft: false
      labels:
        - "update"
      title: "Pull Request Title"

targets: 
  DevChartVersion: 
    name: test
    scmid: updatecli
    sourceid: latestVersion
    kind: yaml
    spec:
      file: "charts/argocd/utils/azure-workload-identity.yaml"
      key: "spec.generators[0].list.elements[1].targetRevision"